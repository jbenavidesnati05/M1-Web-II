<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilos.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>JS avanzado</title>
</head>
<body>
    <h1>Evaluacion momento 1 Desarrollo Web II</h1>


    <div id="form">
        <div class="input-container">
            <h4>ID</h4>
            <input type="text" id="IDInput">
            <label id="IDLabel" ></label>
        </div>
        <div class="input-container">
            <h4>Dirección</h4>
            <input type="text" id="direccionInput">
            <label id="direccionLabel" ></label>
        </div>
        <div class="input-container">
            <h4>Telefono</h4>
            <input type="text" id="telefonoInput">
            <label id="telefonoLabel" ></label>
        </div>
        <div class="input-container">
            <h4>Precio</h4>
            <input type="text" id="precioInput">
            <label id="precioLabel" ></label>
        </div>
        <div class="input-container">
            <h4>Estado</h4>
            <input type="text" id="estadoInput">
            <label id="estadoLabel" ></label>
        </div>
        <h2 id="message"></h2>
        <div class="div-buttons">
            <button id="btnEnviar">Enviar</button>
            <button id="btnBuscar">Buscar</button>
            <button id="btnListar">Listar</button>
        </div>
    </div>

    <div id="container" ></div>

    <script>

        let inmmuebles = [
            
            {
                ID: 123,
                direccion: "Av 44",
                telefono: "6041231232",
                precio: 100,
                estado: true 
            },
            {
                ID: 321,
                direccion: "Av 32",
                telefono: "6041231232",
                precio: 100,
                estado: true 
            },
            {
                ID: 132,
                direccion: "Av 12",
                telefono: "6041231232",
                precio: 100,
                estado: true 
            },
            
            
        ]
        
     
        //Message
        let message = document.getElementById('message') 
        
        //ID

        let inputID = document.getElementById('IDInput')
        let labelID = document.getElementById('IDLabel')
        
        inputID.addEventListener('focus', ()=>{
            labelID.innerText = "Solo se aceptan números"
        })
        inputID.addEventListener('blur', ()=>{
            labelID.innerText = ""
        })

        //Telefono

        let inputTelefono = document.getElementById('telefonoInput')

        
        //Direción
        
        let inputDireccion = document.getElementById('direccionInput')
        let labelDireccion = document.getElementById('direccionLabel')
        
        inputDireccion.addEventListener('focus', ()=>{
            labelDireccion.innerText = "La dirección es obligatoria"
        })
        inputDireccion.addEventListener('blur', ()=>{
            labelDireccion.innerText = ""
        })
        
        //Precio
        
        let inputPrecio = document.getElementById('precioInput')
        let labelPrecio = document.getElementById('precioLabel')
        
        inputPrecio.addEventListener('focus', ()=>{
            labelPrecio.innerText = "El precio debe estar entre 100 y 500 millones"
        })
        inputPrecio.addEventListener('blur', ()=>{
            labelPrecio.innerText = ""
        })
        
        //Estado
        let inputEstado = document.getElementById('estadoInput')


        //Buttons

        let enviarButton = document.getElementById('btnEnviar')
        let buscarButton = document.getElementById('btnBuscar')
        let listarButton = document.getElementById('btnListar')

            //Enviar
            enviarButton.addEventListener('click', () => {
                setTimeout(validarCampos, 4000)
                message.innerText = "Validando datos"
            })
            //Buscar
            buscarButton.addEventListener('click', () => {
                setTimeout(buscarInmueble, 4000)
                message.innerText = "Buscando inmueble"
            })
            //Listar
            listarButton.addEventListener('click', ()=>{
                setTimeout(listarInmuebles, 4000)
                message.innerText = "Listando inmuebles"
            })



        //Funciones

        function validarCampos(){

            if(inputID.value != 0 && inputDireccion.value != "" && inputTelefono.value != "" && inputPrecio.value != 0){
                let inmmueble = {

                    ID: parseInt(inputID.value),
                    direccion: inputDireccion.value,
                    telefono: inputTelefono.value,
                    precio: parseInt(inputPrecio.value),
                    estado: true

                }

                inmmuebles.push(inmmueble)

                message.style.color = "blue"
                message.innerText = "Registrado correctamente"
                setTimeout(()=> message.innerText = "", 3000)
                setTimeout(()=> message.style.color = "black", 4000)
            }
            else{
                message.style.color = "red"
                message.innerText = "Datos incorrectos"
                setTimeout(()=> message.innerText = "", 3000)
                setTimeout(()=> message.style.color = "black", 4000)
            }
            
        }
        
        function buscarInmueble(){
            let IDInmueble= inputID.value
            if( IDInmueble!= 0){

                let encontrado = false
                let inmuebleEncontrado = {}
                
                inmmuebles.forEach(inmmueble => {
                    if(IDInmueble == inmmueble.ID){
                        encontrado = true
                        inmuebleEncontrado = inmmueble
                    }
                });

                if(encontrado){

                    if(inmuebleEncontrado.estado){

                        inputID.value = inmuebleEncontrado.ID
                        inputDireccion.value = inmuebleEncontrado.direccion
                        inputTelefono.value = inmuebleEncontrado.telefono
                        inputPrecio.value = inmuebleEncontrado.precio
                        inputEstado.value = "Activo"

                        message.style.color = "green"
                        message.innerText = "Inmueble encontrado"
                        setTimeout(()=> message.innerText = "", 3000)
                        setTimeout(()=> message.style.color = "black", 4000)
                    }
                    else{
                        message.style.color = "red"
                        message.innerText = "Inmueble inactivo"
                        setTimeout(()=> message.innerText = "", 3000)
                        setTimeout(()=> message.style.color = "black", 4000)
                    }
                    
                }
                else{       
                    message.style.color = "red"
                    message.innerText = "Inmueble no encontrado"
                    setTimeout(()=> message.innerText = "", 3000)
                    setTimeout(()=> message.style.color = "black", 4000)
                }

            }
            else{
                message.style.color = "red"
                message.innerText = "ID invalido"
                setTimeout(()=> message.innerText = "", 3000)
                setTimeout(()=> message.style.color = "black", 4000)
            }
        }
        
        function listarInmuebles(){
            
            promesa = new Promise(function(resolve, reject){
                if(inmmuebles != []){
                    resolve(inmmuebles)
                }
                else{
                    reject("No hay inmuebles")
                }
            })
            
            promesa
            .then(inmmuebles => {

                console.log(inmmuebles)
                
                let registrosInmuebles = ""
                inmmuebles.forEach(inmmueble => {
                    registrosInmuebles += 
                    `
                    <tr>
                        <td>
                            ${inmmueble.ID}
                        </td>
                        <td>
                            ${inmmueble.direccion}
                        </td>
                        <td>
                            ${inmmueble.telefono}
                        </td>
                        <td>
                            ${inmmueble.precio}
                        </td>
                        <td>
                            ${inmmueble.estado == true ? "Activo" : "Inactivo"}
                        </td>
                    </tr>
                    `
                })

                table = `
                
                <table>
                    <tr>
                        <th>
                            ID
                        </th>
                        <th>
                            Dirección
                        </th>
                        <th>
                            Telefono
                        </th>
                        <th>
                            Precio
                        </th>
                        <th>
                            Estado
                        </th>
                    </tr>
                    ${
                        registrosInmuebles
                    }
                </table>

                `

                document.getElementById("container").innerHTML = table

                message.style.color = "green"
                message.innerText = "Inmmuebles listados"
                setTimeout(()=> message.innerText = "", 3000)
                setTimeout(()=> message.style.color = "black", 4000)
                
            })
            .catch(message => {
                if(message == "No hay inmuebles"){
                    message.style.color = "red"
                    message.innerText = "No hay inmuebles para listar"
                    setTimeout(()=> message.innerText = "", 3000)
                    setTimeout(()=> message.style.color = "black", 4000)
                }
            })
        }
        
        </script>
        <style>
            label{
                color: blueviolet;
            }
            .div-buttons{
                margin-top: 20px;
            }
            #container{
                margin-top: 20px;
            }
        </style>
</body>
</html>